<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–≤–∏–∑ –ø–æ –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏</title>
    <style>
        body {
            font-family: 'Onest', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0; 
            min-height: 100vh;
            box-sizing: border-box;
            color: white; 
            background: linear-gradient(170.3deg, #BE0773 3.42%, #2B40E8 50.95%, #00A3FF 97.51%);
            background-attachment: fixed; 
        }

        .header-container {
            text-align: center;
            margin-top: 35px;
            padding: 0 30px; 
        }

        .logo {
            width: auto; 
            height: auto;
            margin-bottom: 20px; 
        }
        
        .main-title {
            font-family: 'Onest', sans-serif;
            font-weight: 600;
            font-size: 28px;
            line-height: 99%; 
            letter-spacing: 0%;
            text-align: center;
            color: white;
            margin-top: 0;
            margin-bottom: 15px; 
        }

        .subtitle {
            font-family: 'Onest', sans-serif;
            font-weight: 400;
            font-size: 16px;
            line-height: 110%;
            letter-spacing: 0%;
            text-align: center;
            color: white;
            max-width: 600px; 
            margin: 0 auto 26px auto; 
        }

        #game-container {
            display: flex;
            flex-wrap: wrap; 
            width: auto;
            max-width: calc(100% - 40px); 
            align-items: flex-start; 
            justify-content: center; 
            margin-bottom: 30px; 
        }

        #grid-container {
            user-select: none;
            overflow: auto; 
            margin-right: 20px; 
        }

        #letter-grid {
            border-collapse: collapse;
            margin: 0 auto; 
        }

        #letter-grid td {
            width: 30px; 
            height: 30px;
            border: 1px solid white; 
            text-align: center;
            font-size: 16px; 
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            background-color: rgba(255, 255, 255, 0.15); 
            color: white; 
        }

        #letter-grid td.selected {
            background-color: rgba(255, 255, 255, 0.4); 
            color: #2B40E8; 
        }

        #letter-grid td.found {
            background-color: #28a745; 
            color: white; 
            font-weight: bold;
        }
        
        #letter-grid td.found.selected {
            background-color: rgba(255, 255, 255, 0.4); 
            color: #2B40E8; 
        }

        #questions-container {
            max-width: 400px; 
            min-width: 300px; 
            display: flex;
            flex-direction: column;
        }
        
        #questions-container h2 { 
            font-family: 'Onest', sans-serif;
            font-weight: 600; 
            font-size: 22px;
            color: white;
            text-align: center;
            margin-top: 0; 
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        #questions-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        #questions-list li {
            padding: 10px 0px; 
/*            border-bottom: 1px solid rgba(255,255,255,0.2); */
            font-family: 'Onest', sans-serif;
            font-weight: 400;
            font-size: 18px;
            line-height: 120%;
/*            text-indent: 10px;*/
            letter-spacing: 0%;
            color: white; 
            transition: color 0.3s ease, background-color 0.3s ease;
        }
         #questions-list li.not-placed {
            opacity: 0.6; 
            font-style: italic;
        }
        
        #questions-list li:last-child {
            border-bottom: none;
        }

        #questions-list li.question-found {
            color: #90ee90; 
            text-decoration: line-through;
            font-weight: bold;
            background-color: rgba(40, 167, 69, 0.3); 
        }
        
        #win-message {
            text-align: center;
            font-size: 24px;
            color: #90ee90; 
            margin: 0 20px 20px 20px;
            background-color: rgba(0,0,0,0.3); 
            padding: 20px;
            border-radius: 8px;
        }
        #restart-button-container {
            text-align: center;
            margin-top: 15px;
        }
        #restart-button {
            padding: 12px 25px;
            font-size: 18px;
            font-family: 'Onest', sans-serif;
            font-weight: 600;
            color: #2B40E8; 
            background-color: white; 
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        #restart-button:hover {
            background-color: #f0f0f0;
            transform: scale(1.05);
        }

        .footer {
            width: 100%;
            max-width: 800px; 
            margin: 0px auto 20px auto;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            box-sizing: border-box;
        }

        .footer-link { /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–µ–≤–æ–π —Å—Å—ã–ª–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ */
            font-family: 'Onest', sans-serif;
            font-weight: 400;
            font-size: 16px;
            line-height: 110%;
            letter-spacing: 0%;
        }
        .footer-link a {
            color: white;
            text-decoration: underline;
            text-decoration-style: solid;
            text-underline-offset: 3px; 
        }
        
        .footer-tg { /* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –±—É–¥—É—Ç –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ */
             font-family: 'Onest', sans-serif;
             font-weight: 400;
             font-size: 16px;
             line-height: 110%;
             letter-spacing: 0%;
        }
        .footer-tg-link { /* –°—Å—ã–ª–∫–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –∏–∫–æ–Ω–∫—É –∏ —Ç–µ–∫—Å—Ç */
            display: flex; 
            align-items: center; 
            color: white; 
            text-decoration: none; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Å—ã–ª–∫–∏ */
        }
        .footer-tg-link span { /* –¢–µ–∫—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å —Å—Å—ã–ª–∫–∏ */
            text-decoration: underline; /* –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç */
            text-decoration-style: solid;
            text-underline-offset: 3px; 
        }
        .tg-icon {
            width: 18px;
            height: 18px;
            margin-right: 4px; 
            vertical-align: middle; 
        }


        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            body { padding: 0; }
            .header-container { margin-top: 25px; margin-bottom: 0; }

            #game-container { 
                flex-direction: column; 
                align-items: center; 
                gap: 20px; 
                padding: 0 30px; 
                max-width: 100%;
                margin-left: 0;
                margin-right: 0;
                box-sizing: border-box;
            }
            #grid-container { 
                width: 100%; 
                margin-right: 0; 
            }
             #letter-grid td { 
                 width: calc((100vw - 40px - (var(--grid-cols, 10) - 1) * 1px) / var(--grid-cols, 10) ); 
                 height: calc((100vw - 40px - (var(--grid-cols, 10) - 1) * 1px) / var(--grid-cols, 10) );
                 max-width: 35px; 
                 max-height: 35px;
                 min-width: 24px; 
                 min-height: 24px;
                 font-size: 14px; 
            }


            #questions-container { 
                max-width: 100%; 
                width: 100%; 
                min-width: unset; 
                margin-top: 0; 
            }
            
            #win-message { font-size: 20px; }
        }
    </style>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(102094782, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/102094782" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
</head>
<body>
    <div class="header-container">
        <img src="https://ai-pets-avatars.s3.us-east-1.amazonaws.com/usermodels/game_PHD2025-logo-2.svg" alt="QAPP Quiz Logo" class="logo">
        <h1 class="main-title">–ö–≤–∏–∑ –ø–æ –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h1>
        <p class="subtitle">–ù–∞–π–¥–∏ 5 —Å–ª–æ–≤ –≤ —Å–µ—Ç–∫–µ, –æ—Ç–≤–µ—á–∞—è –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã-–ø–æ–¥—Å–∫–∞–∑–∫–∏, –∏ –ø–æ–ª—É—á–∏ –≤–∫—É—Å–Ω—ã–π –ø—Ä–∏–∑! üç¨</p>
    </div>
    
    <div id="game-container">
        <div id="grid-container">
            <table id="letter-grid"></table>
        </div>
        <div id="questions-container">
            <h2></h2>
            <ul id="questions-list"></ul>
        </div>
    </div>

    <div id="win-message" style="display:none;">
        –ú–æ–ª–æ–¥–µ—Ü!<br>–ü–æ–ª—É—á–∏ —Å–ª–∞–¥–∫–∏–π –ø—Ä–∏–∑ –Ω–∞ —Å—Ç–µ–Ω–¥–µ ¬´–ü–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è¬ª
        <div id="restart-button-container">
            <button id="restart-button">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-link">
            <a href="https://qapp.tech/" target="_blank">qapp.tech</a>
        </div>
        <div class="footer-tg"> <!-- –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ -->
            <a href="https://t.me/qapptech" target="_blank" class="footer-tg-link"> <!-- –°—Å—ã–ª–∫–∞-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                <img src="https://ai-pets-avatars.s3.us-east-1.amazonaws.com/usermodels/telegram-svgrepo-com+1.svg" alt="Telegram" class="tg-icon">
                <span>@qapptech</span> <!-- –¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç -->
            </a>
        </div>
    </footer>

    <script>
        // –í–ê–ñ–ù–û: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–ª–æ–≤–∞ –¥–ª–∏–Ω–Ω–µ–µ 10 –±—É–∫–≤ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ —ç—Ç–∏—Ö —Å–ø–∏—Å–∫–æ–≤.
        const SIMPLE_QA_RAW = [
            { q: "–ü—Ä–æ–µ–∫—Ç –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–≤–∞–Ω—Ç–æ–≤–æ-—É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≠–¶–ü –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏", a: "–ì–∏–ø–µ—Ä–∏–∫—É–º" }, // 9
            { q: "–®–∏—Ñ—Ä–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞, –∫–æ—Ç–æ—Ä—É—é –≤–∑–ª–æ–º–∞–ª –ê–ª–∞–Ω –¢—å—é—Ä–∏–Ω–≥", a: "–≠–Ω–∏–≥–º–∞" }, // 6
            { q: "–°–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–µ–∫—Å—Ç–∞ –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö—ç—à", a: "–ö–æ–ª–ª–∏–∑–∏—è" }, // 8
            { q: "–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –±–ª–æ—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è", a: "–ö—É–∑–Ω–µ—á–∏–∫" }, // 8
            { q: "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –±–ª–æ—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è", a: "–ú–∞–≥–º–∞" },   // 5
            { q: "–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è", a: "–°—Ç—Ä–∏–±–æ–≥" }, // 7
            { q: "–°–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–ª—è–µ–º—ã–µ –∫ –ø–∞—Ä–æ–ª—é –ø–µ—Ä–µ–¥ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º", a: "–°–æ–ª—å" },    // 4
            { q: "–ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º", a: "–ë–∏–æ–º–µ—Ç—Ä–∏—è" }, // 9
            { q: "–ú–µ—Ç–æ–¥, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è", a: "–ü–æ–¥–ø–∏—Å—å" }, // 7
            { q: "–§–∏–∑–∏—á–µ—Å–∫–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏", a: "–¢–æ–∫–µ–Ω" },   // 5
            { q: "–¶–µ–ø–æ—á–∫–∞ –±–ª–æ–∫–æ–≤ —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö—ç—à-—Ñ—É–Ω–∫—Ü–∏–π", a: "–ë–ª–æ–∫—á–µ–π–Ω" },// 9
            { q: "–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∏", a: "–ö–ª—é—á" },    // 4
            { q: "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è", a: "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ" },// 10
            { q: "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö", a: "–®–∏—Ñ—Ä–∞—Ç–æ—Ä" }, // 8
            { q: "–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º", a: "–ü–∞—Ä–æ–ª—å" }  // 6
        ];

        const COMPLEX_QA_RAW = [
            { q: "–û–±–ª–∞—Å—Ç—å –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç Kyber/ML-KEM", a: "–†–µ—à–µ—Ç–∫–∏" }, // 7
            { q: "–û–±–ª–∞—Å—Ç—å –ø–æ—Å—Ç–∫–≤–∞–Ω—Ç–æ–≤–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫—Ä–∏–ø—Ç–æ—Å–∏—Å—Ç–µ–º–∞ –ú–∞–∫-–≠–ª–∏—Å–∞", a: "–ö–æ–¥—ã" }, // 4
            { q: "–§–∞–º–∏–ª–∏—è –∞–≤—Ç–æ—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –≤–∑–ª–æ–º–∞ RSA —Å –ø–æ–º–æ—â—å—é –∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞", a: "–®–æ—Ä" }, // 3
            { q: "–ö–≤–∞–Ω—Ç–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, –¥–∞—é—â–∏–π –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞—Ç–∞–∫–∏ –ø–µ—Ä–µ–±–æ—Ä–æ–º", a: "–ì—Ä–æ–≤–µ—Ä" }, // 6
            { q: "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—â–∞—è –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã", a: "–•—ç—à" } // 3
        ];

        const NUM_SIMPLE_QUESTIONS = 4;
        const NUM_COMPLEX_QUESTIONS = 1;
        const MIN_GRID_DIMENSION = 10; 
        const MAX_GRID_DIMENSION = 12; 
        const MAX_PLACEMENT_ATTEMPTS_PER_WORD = 250; 

        let CURRENT_QUIZ_QA_LIST = []; 
        let GRID_ROWS = MIN_GRID_DIMENSION;
        let GRID_COLS = MIN_GRID_DIMENSION;

        let grid = []; 
        let selectedCells = []; 
        let placedWordsData = []; 

        const alphabet = "–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø";

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function selectQuizQuestions() {
            const activeSimpleQA = SIMPLE_QA_RAW.filter(qa => qa.a && qa.a.length <= 10);
            const activeComplexQA = COMPLEX_QA_RAW.filter(qa => qa.a && qa.a.length <= 10);

            if (activeSimpleQA.length < NUM_SIMPLE_QUESTIONS) {
                console.error(`Not enough active simple questions (<=10 letters) (need ${NUM_SIMPLE_QUESTIONS}, have ${activeSimpleQA.length})`);
                alert("–û—à–∏–±–∫–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–¥–ª–∏–Ω–æ–π –¥–æ 10 –±—É–∫–≤) –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.");
                return false;
            }
            if (activeComplexQA.length < NUM_COMPLEX_QUESTIONS) {
                console.error(`Not enough active complex questions (<=10 letters) (need ${NUM_COMPLEX_QUESTIONS}, have ${activeComplexQA.length})`);
                alert("–û—à–∏–±–∫–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–¥–ª–∏–Ω–æ–π –¥–æ 10 –±—É–∫–≤) –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã.");
                return false;
            }

            shuffleArray(activeSimpleQA);
            shuffleArray(activeComplexQA);

            const selectedSimple = activeSimpleQA.slice(0, NUM_SIMPLE_QUESTIONS);
            const selectedComplex = activeComplexQA.slice(0, NUM_COMPLEX_QUESTIONS);
            
            CURRENT_QUIZ_QA_LIST = [...selectedSimple, ...selectedComplex].map((item, index) => ({
                question: item.q,
                answer: item.a.toUpperCase().replace(/\s+/g, ''),
                originalAnswer: item.a,
                id: `question-${index}-${item.a.toUpperCase().replace(/\s+/g, '').replace(/[^A-Z–ê-–Ø0-9]/ig, '')}`, 
                found: false,
                cells: [] 
            }));
            shuffleArray(CURRENT_QUIZ_QA_LIST); 
            console.log("Selected questions for this quiz:", CURRENT_QUIZ_QA_LIST.map(q => q.originalAnswer));
            return true;
        }

        function determineGridSize() {
            let maxLength = 0;
            if (CURRENT_QUIZ_QA_LIST.length > 0) {
                CURRENT_QUIZ_QA_LIST.forEach(qa => {
                    if (qa.answer.length > maxLength) {
                        maxLength = qa.answer.length;
                    }
                });
            } else {
                GRID_ROWS = MIN_GRID_DIMENSION;
                GRID_COLS = MIN_GRID_DIMENSION;
                console.log(`No questions selected, defaulting grid to ${GRID_ROWS}x${GRID_COLS}`);
                return;
            }
            
            let dimension;
             if (maxLength <= 7) { 
                dimension = MIN_GRID_DIMENSION; 
            } else if (maxLength <= 9) { 
                dimension = Math.max(MIN_GRID_DIMENSION, maxLength + 2); 
            } else { 
                dimension = Math.max(MIN_GRID_DIMENSION, maxLength + 1); 
            }
            dimension = Math.min(dimension, MAX_GRID_DIMENSION); 

            GRID_ROWS = dimension;
            GRID_COLS = dimension;
            document.documentElement.style.setProperty('--grid-cols', GRID_COLS);
            console.log(`Determined grid size: ${GRID_ROWS}x${GRID_COLS} (maxLengthWord: ${maxLength})`);
        }
        
        function resetGame() {
            selectedCells = [];
            placedWordsData = [];
            CURRENT_QUIZ_QA_LIST = [];
            document.getElementById('win-message').style.display = 'none';
            
            const gridTable = document.getElementById('letter-grid');
            if (gridTable) gridTable.innerHTML = '';
            
            const questionsUl = document.getElementById('questions-list');
            if (questionsUl) questionsUl.innerHTML = '';
            
            initGame();
        }

        function initGame() {
            console.log("Initializing new game...");
            if (!selectQuizQuestions()) {
                const gridTable = document.getElementById('letter-grid');
                if (gridTable) gridTable.innerHTML = '<tr><td>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–ø—Ä–æ—Å–æ–≤.</td></tr>';
                const questionsUl = document.getElementById('questions-list');
                if (questionsUl) questionsUl.innerHTML = '<li>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –∏ —Å–ø–∏—Å–∫–∏ —Å–ª–æ–≤.</li>';
                document.getElementById('game-container').style.display = 'none';
                return;
            }
            document.getElementById('game-container').style.display = 'flex';

            if (CURRENT_QUIZ_QA_LIST.length === 0) {
                alert("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–≥—Ä—ã –ø—É—Å—Ç –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞.");
                return;
            }

            determineGridSize();
            prepareGridData();
            renderGrid();
            renderQuestions();

            if (placedWordsData.length < CURRENT_QUIZ_QA_LIST.length) {
                 console.warn(`Could only place ${placedWordsData.length} out of ${CURRENT_QUIZ_QA_LIST.length} selected words. Grid: ${GRID_ROWS}x${GRID_COLS}.`);
            }
            if (placedWordsData.length === 0 && CURRENT_QUIZ_QA_LIST.length > 0) {
                 console.error("CRITICAL: No words were placed from the selected quiz words.");
                 alert("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –Ω–∞ —Å–µ—Ç–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–æ–≤–∞.");
            }
        }

        function getRandomLetter() {
            return alphabet[Math.floor(Math.random() * alphabet.length)];
        }

        function prepareGridData() {
            grid = Array(GRID_ROWS).fill(null).map(() => Array(GRID_COLS).fill(null));
            placedWordsData = []; 

            const wordsToPlaceThisTurn = [...CURRENT_QUIZ_QA_LIST].sort((a, b) => b.answer.length - a.answer.length);

            wordsToPlaceThisTurn.forEach(qaItem => {
                const word = qaItem.answer;
                if (word.length > GRID_COLS && word.length > GRID_ROWS) {
                     console.warn(`Word "${word}" (len ${word.length}) might be too long for grid ${GRID_ROWS}x${GRID_COLS}. Checking H/V fit.`);
                }

                let placed = false;
                for (let attempt = 0; attempt < MAX_PLACEMENT_ATTEMPTS_PER_WORD && !placed; attempt++) {
                    const direction = Math.random() < 0.5 ? 'horizontal' : 'vertical';
                    let r_start, c_start;
                    let wordCellsCoords = [];

                    if (direction === 'horizontal') {
                        if (word.length > GRID_COLS) continue; 
                        r_start = Math.floor(Math.random() * GRID_ROWS);
                        c_start = Math.floor(Math.random() * (GRID_COLS - word.length + 1));
                    } else { 
                        if (word.length > GRID_ROWS) continue; 
                        r_start = Math.floor(Math.random() * (GRID_ROWS - word.length + 1));
                        c_start = Math.floor(Math.random() * GRID_COLS);
                    }

                    let canPlace = true;
                    for (let i = 0; i < word.length; i++) {
                        const curR = direction === 'horizontal' ? r_start : r_start + i;
                        const curC = direction === 'horizontal' ? c_start + i : c_start;
                        
                        if (grid[curR][curC] !== null && grid[curR][curC] !== word[i]) {
                            canPlace = false;
                            break;
                        }
                    }

                    if (canPlace) {
                        for (let i = 0; i < word.length; i++) {
                            const curR = direction === 'horizontal' ? r_start : r_start + i;
                            const curC = direction === 'horizontal' ? c_start + i : c_start;
                            grid[curR][curC] = word[i];
                            wordCellsCoords.push({ r: curR, c: curC });
                        }
                        
                        const placedWordEntry = {...qaItem, cells: wordCellsCoords, direction: direction, found: false};
                        placedWordsData.push(placedWordEntry);
                        placed = true;
                    }
                }
                if (!placed) {
                    console.warn(`Could not place word: "${word}" (len ${word.length}) after ${MAX_PLACEMENT_ATTEMPTS_PER_WORD} attempts on ${GRID_ROWS}x${GRID_COLS} grid.`);
                }
            });

            for (let r_fill = 0; r_fill < GRID_ROWS; r_fill++) {
                for (let c_fill = 0; c_fill < GRID_COLS; c_fill++) {
                    if (grid[r_fill][c_fill] === null) {
                        grid[r_fill][c_fill] = getRandomLetter();
                    }
                }
            }
        }

        function renderGrid() {
            const gridTable = document.getElementById('letter-grid');
            gridTable.innerHTML = ''; 
            let baseCellSize = 30; 
            if (GRID_COLS > 10) { baseCellSize = 28; }
            if (GRID_COLS > 12) { baseCellSize = 26; }

            for (let r_render = 0; r_render < GRID_ROWS; r_render++) {
                const tr = document.createElement('tr');
                for (let c_render = 0; c_render < GRID_COLS; c_render++) {
                    const td = document.createElement('td');
                    td.textContent = grid[r_render][c_render];
                    td.dataset.r = r_render;
                    td.dataset.c = c_render;
                    td.style.width = `${baseCellSize}px`;
                    td.style.height = `${baseCellSize}px`;
                    td.style.fontSize = `${Math.max(10, baseCellSize - 12)}px`; 
                    td.addEventListener('click', handleCellClick);
                    tr.appendChild(td);
                }
                gridTable.appendChild(tr);
            }
        }

        function renderQuestions() {
            const questionsUl = document.getElementById('questions-list');
            questionsUl.innerHTML = '';
            
            const placedAnswersMap = new Map(placedWordsData.map(pwd => [pwd.answer, pwd]));
            let questionNumber = 1;

            CURRENT_QUIZ_QA_LIST.forEach(quizQaItem => {
                const li = document.createElement('li');
                li.textContent = `${questionNumber}. ${quizQaItem.question}`;
                li.id = quizQaItem.id;

                const placedVersion = placedAnswersMap.get(quizQaItem.answer);
                if (placedVersion && placedVersion.found) {
                    li.classList.add('question-found');
                } else if (CURRENT_QUIZ_QA_LIST.length > 0 && !placedVersion) { 
                     li.classList.add('not-placed');
                     li.title = "–û—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ —Å–µ—Ç–∫–µ.";
                }
                questionsUl.appendChild(li);
                questionNumber++;
            });

            if (CURRENT_QUIZ_QA_LIST.length > 0 && placedWordsData.length === 0 && questionsUl.children.length > 0) {
                 const firstLi = questionsUl.firstChild;
                 if (firstLi) {
                    const errorLi = document.createElement('li');
                    errorLi.textContent = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–ª–æ–≤–∞ –¥–ª—è —ç—Ç–æ–π –∏–≥—Ä—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.";
                    errorLi.style.color = "orange";
                    questionsUl.insertBefore(errorLi, firstLi);
                 }
            } else if (CURRENT_QUIZ_QA_LIST.length === 0) {
                 questionsUl.innerHTML = "<li>–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</li>";
            }
        }
        
        function handleCellClick(event) {
            const clickedTd = event.target;
            if (document.getElementById('win-message').style.display === 'block' || 
               (CURRENT_QUIZ_QA_LIST.length > 0 && placedWordsData.length === 0) ) {
                return;
            }

            const r_click = parseInt(clickedTd.dataset.r);
            const c_click = parseInt(clickedTd.dataset.c);

            const cellIndexInSelection = selectedCells.findIndex(cell => cell.td === clickedTd);

            if (cellIndexInSelection > -1) {
                clickedTd.classList.remove('selected');
                selectedCells.splice(cellIndexInSelection, 1);
            } else {
                clickedTd.classList.add('selected');
                selectedCells.push({ td: clickedTd, r: r_click, c: c_click, letter: clickedTd.textContent });
            }
            checkSelectedWord();
        }

        function getSubsets(array, size) {
            const result = [];
            const temp = [];
            function findSubsetsRecursive(start) {
                if (temp.length === size) { result.push([...temp]); return; }
                if (start === array.length) { return; }
                temp.push(array[start]);
                findSubsetsRecursive(start + 1);
                temp.pop();
                findSubsetsRecursive(start + 1);
            }
            findSubsetsRecursive(0);
            return result;
        }

        function checkSelectedWord() {
            if (selectedCells.length === 0 || placedWordsData.length === 0) return;
            
            for (const wordData of placedWordsData) {
                if (wordData.found) continue;

                const targetWordString = wordData.answer;
                const targetWordCellsOnGrid = wordData.cells; 

                if (selectedCells.length < targetWordString.length) continue;

                const potentialSubsets = getSubsets(selectedCells, targetWordString.length);

                for (const subset of potentialSubsets) {
                    const subsetCoordsCanonical = subset.map(sc => `${sc.r},${sc.c}`).sort().join(';');
                    const targetWordCellsCanonical = targetWordCellsOnGrid.map(tc => `${tc.r},${tc.c}`).sort().join(';');

                    if (subsetCoordsCanonical === targetWordCellsCanonical) {
                        let formedWordFromSubset = "";
                        let lettersAreCorrect = true;
                        for (const targetGridCell of targetWordCellsOnGrid) {
                            const matchingCellInSubset = subset.find(subCell => subCell.r === targetGridCell.r && subCell.c === targetGridCell.c);
                            if (matchingCellInSubset) {
                                formedWordFromSubset += matchingCellInSubset.letter;
                            } else { lettersAreCorrect = false; break; }
                        }
                        
                        if (lettersAreCorrect && (formedWordFromSubset === targetWordString || formedWordFromSubset.split('').reverse().join('') === targetWordString)) {
                            wordData.found = true; 

                            subset.forEach(cellObj => {
                                cellObj.td.classList.remove('selected');
                                cellObj.td.classList.add('found');
                            });

                            selectedCells.forEach(originalCellObj => {
                                if (!subset.some(subCell => subCell.td === originalCellObj.td)) {
                                    originalCellObj.td.classList.remove('selected');
                                }
                            });
                            
                            const questionLi = document.getElementById(wordData.id);
                            if (questionLi) {
                                questionLi.classList.remove('not-placed'); 
                                questionLi.classList.add('question-found');
                                questionLi.title = ""; 
                            } else { console.warn("Could not find LI for ID:", wordData.id); }
                            
                            selectedCells = []; 
                            checkWinCondition();
                            return; 
                        }
                    }
                } 
            } 
        }
        
        function checkWinCondition() {
            if (placedWordsData.length === 0 && CURRENT_QUIZ_QA_LIST.length > 0) { 
                return;
            }
            const allPlacedWordsFound = placedWordsData.length > 0 && placedWordsData.every(word => word.found);
            
            if (allPlacedWordsFound) {
                const winMessageDiv = document.getElementById('win-message');
                winMessageDiv.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            document.getElementById('restart-button').addEventListener('click', resetGame);
        });

    </script>
</body>
</html>